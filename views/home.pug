include partials/simpleLoadingOverlay.pug
include partials/reportLoadingOverlay.pug

doctype html
html(lang="ru")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Аналитика Google Ads и SalesDrive
    link(rel="stylesheet", href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css")
    style.
      body {
        background: linear-gradient(160deg, #f4f7ff 0%, #eef2ff 40%, #fdfdff 100%);
        min-height: 100vh;
      }
      .home-layout {
        max-width: 1180px;
      }
      .home-header {
        position: sticky;
        top: 0;
        z-index: 20;
        margin-bottom: 2.5rem;
      }
      .home-header .toolbar {
        background: rgba(255, 255, 255, 0.88);
        backdrop-filter: blur(12px);
        border-radius: 24px;
        padding: 1rem 1.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 18px 48px rgba(13, 110, 253, 0.08);
      }
      .home-header .toolbar .brand h1 {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 0.35rem;
        color: #1f2a56;
      }
      .home-header .toolbar .brand p {
        margin-bottom: 0;
        color: #7a86a0;
        font-size: 0.925rem;
      }
      .settings-fab {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #4f46e5, #3b82f6);
        color: #fff;
        box-shadow: 0 12px 32px rgba(59, 130, 246, 0.35);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .settings-fab:hover,
      .settings-fab:focus {
        color: #fff;
        transform: translateY(-3px);
        box-shadow: 0 20px 38px rgba(59, 130, 246, 0.4);
        text-decoration: none;
      }
      .settings-fab span {
        display: none;
      }
      .metric-card {
        border-radius: 18px;
        background: #fff;
        border: none;
        box-shadow: 0 18px 40px rgba(30, 64, 175, 0.08);
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        height: 100%;
      }
      .metric-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 28px 50px rgba(30, 64, 175, 0.12);
      }
      .metric-card .icon-badge {
        width: 56px;
        height: 56px;
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.6rem;
        margin-right: 1rem;
      }
      .metric-card .list-inline-item {
        font-size: 0.95rem;
        color: #6b7280;
      }
      .reports-section h3 {
        font-weight: 600;
        color: #1f2937;
      }
      .report-card {
        border-radius: 20px;
        border: none;
        background: #fff;
        box-shadow: 0 22px 48px rgba(15, 23, 42, 0.08);
        height: 100%;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
      }
      .report-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 32px 56px rgba(15, 23, 42, 0.12);
      }
      .report-card .btn {
        border-radius: 14px;
        font-weight: 600;
      }
      .status-bar {
        border-radius: 18px;
        background: rgba(255, 255, 255, 0.86);
        border: 1px solid rgba(148, 163, 184, 0.18);
        padding: 1.25rem;
        margin-top: 2.5rem;
        box-shadow: 0 12px 34px rgba(148, 163, 184, 0.18);
      }
      .status-bar strong {
        color: #0f172a;
      }
      .status-bar small {
        color: #64748b;
      }
      @media (max-width: 767.98px) {
        .home-header .toolbar {
          flex-direction: column;
          align-items: flex-start;
          gap: 1rem;
        }
        .settings-fab {
          width: auto;
          border-radius: 999px;
          padding: 0.5rem 1.1rem;
        }
        .settings-fab span {
          display: inline;
          margin-left: 0.4rem;
          font-size: 0.85rem;
          font-weight: 500;
        }
      }
  body
    .container.py-5.home-layout
      header.home-header
        .toolbar
          .brand
            h1 Центр Google Ads и SalesDrive
            p Управляйте источниками, отчётами и доступом без лишних действий.
          a.settings-fab(href="/settings" data-report-link aria-label="Открыть настройки")
            i.bi.bi-gear-fill
            span Настройки
      if successMessage
        .alert.alert-success.shadow-sm.rounded-pill.px-4.py-2.mb-4= successMessage
      if errorMessage
        .alert.alert-danger.shadow-sm.rounded-pill.px-4.py-2.mb-4= errorMessage
      section.mt-4
        .row
          .col-lg-4.col-md-6.mb-4
            .card.metric-card
              .card-body
                .d-flex.align-items-center.mb-3
                  .icon-badge.bg-primary.text-white
                    i.bi.bi-collection-play-fill
                  div
                    h5.mb-1.text-dark Источники SalesDrive
                    small.text-muted Централизованное управление
                h2.h4.text-dark.mb-1= sourcesCount
                p.text-muted.mb-3 Просматривайте и обновляйте список каналов продаж в разделе настроек.
                ul.list-inline.mb-0
                  li.list-inline-item
                    i.bi.bi-check-circle.text-success.mr-1
                    | Синхронизировано
          .col-lg-4.col-md-6.mb-4
            .card.metric-card
              .card-body
                .d-flex.align-items-center.mb-3
                  .icon-badge.bg-warning.text-white
                    i.bi.bi-calendar-week
                  div
                    h5.mb-1.text-dark Планировщик отчётов
                    small.text-muted Автоматическое обновление
                span.badge.badge-pill(class=scheduleInfo.enabled ? 'badge-success' : 'badge-secondary')= scheduleInfo.statusLabel
                p.text-muted.mt-2.mb-2 #{scheduleInfo.frequencyLabel} в #{scheduleInfo.time}
                small.d-block.text-muted.mb-1 Следующий запуск: #{scheduleInfo.nextRunLabel}
                small.d-block.text-muted Диапазон: #{scheduleInfo.rangeLabel}
                a.btn.btn-outline-primary.btn-sm.rounded-pill.mt-3(href="/settings?tab=scheduler" data-report-link)
                  i.bi.bi-sliders.mr-2
                  | Настроить расписание
          .col-lg-4.col-md-6.mb-4
            .card.metric-card
              .card-body
                .d-flex.align-items-center.mb-3
                  .icon-badge.bg-success.text-white
                    i.bi.bi-shield-lock-fill
                  div
                    h5.mb-1.text-dark Защита доступа
                    small.text-muted Контролируемый кабинет
                span.badge.badge-pill(class=accessInfo.enabled ? 'badge-success' : 'badge-secondary')= accessInfo.statusLabel
                p.text-muted.mt-2.mb-2= `Пользователь: ${accessInfo.username}`
                small.d-block.text-muted Сессия завершится через 60 минут после входа.
                a.btn.btn-outline-success.btn-sm.rounded-pill.mt-3(href="/settings?tab=access" data-report-link)
                  i.bi.bi-person-lock.mr-2
                  | Настроить доступ
      section.reports-section.mt-5
        .d-flex.justify-content-between.align-items-center.mb-3
          h3.mb-0 Выберите отчёт
          small.text-muted Построение учитывает лимиты SalesDrive.
        - const heavyReportIds = ['summary', 'monthly']
        .row
          each report in reports
            .col-lg-6.col-md-6.mb-4
              .card.report-card
                .card-body.d-flex.flex-column
                  h5.card-title.font-weight-semibold.text-dark= report.title
                  p.text-muted.flex-grow-1= report.description
                  - const overlayTarget = heavyReportIds.includes(report.id) ? 'heavy' : 'simple'
                  a.btn.btn-primary.mt-3.align-self-start(data-report-link, data-overlay-target=overlayTarget href=`/reports/${report.id}`)
                    i.bi.bi-arrow-right-circle.mr-2
                    | Открыть
      section.status-bar.mt-5
        .d-flex.flex-column.flex-md-row.align-items-md-center.justify-content-between
          div
            strong Планировщик статических отчётов:&nbsp;
            span= scheduleInfo.statusLabel
          div.mt-3.mt-md-0
            small Последние действия синхронизируются автоматически. Настраивайте параметры через значок шестерёнки.
    +simpleLoadingOverlay({ id: 'homeSimpleOverlay' })
    +reportLoadingOverlay({ message: 'Готовим отчёт…' })
    script(src="https://code.jquery.com/jquery-3.5.1.slim.min.js")
    script(src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js")
    script(src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js")
