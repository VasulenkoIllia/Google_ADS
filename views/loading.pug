include partials/reportLoadingOverlay.pug

html(lang="uk")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    if waitSeconds && waitSeconds > 0
      if reloadUrl && reloadUrl.length
        meta(http-equiv="refresh", content=`${waitSeconds};url=${reloadUrl}`)
      else
        meta(http-equiv="refresh", content=waitSeconds)
    title Формування звіту
    link(rel="stylesheet", href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css")
  body.bg-light
    - const resolvedMinuteLimit = Number.isFinite(salesDriveLimit) ? salesDriveLimit : (queueInfo && Number.isFinite(queueInfo.maxPerInterval) ? queueInfo.maxPerInterval : null)
    - const resolvedIntervalSeconds = Number.isFinite(intervalSeconds) ? intervalSeconds : (queueInfo && Number.isFinite(queueInfo.intervalSeconds) ? queueInfo.intervalSeconds : null)
    - const resolvedHourlyLimit = Number.isFinite(hourlyLimit) ? hourlyLimit : (queueInfo && Number.isFinite(queueInfo.hourlyLimit) ? queueInfo.hourlyLimit : null)
    - const resolvedDailyLimit = Number.isFinite(dailyLimit) ? dailyLimit : (queueInfo && Number.isFinite(queueInfo.dailyLimit) ? queueInfo.dailyLimit : null)
    - const overlayMeta = {}
    - overlayMeta.waitSeconds = Number.isFinite(waitSeconds) ? waitSeconds : null
    - overlayMeta.queueAhead = queueInfo && Number.isFinite(queueInfo.queueAhead) ? queueInfo.queueAhead : null
    - overlayMeta.estimatedTotalRequests = queueInfo && Number.isFinite(queueInfo.estimatedTotalRequests) ? queueInfo.estimatedTotalRequests : null
    - overlayMeta.remainingSources = queueInfo && Number.isFinite(queueInfo.remainingSources) ? queueInfo.remainingSources : null
    -
      overlayMeta.rateLimitMeta = {
        minuteLimit: resolvedMinuteLimit,
        minuteIntervalSeconds: resolvedIntervalSeconds,
        hourlyLimit: resolvedHourlyLimit,
        dailyLimit: resolvedDailyLimit
      };
    - overlayMeta.hourlyRemaining = queueInfo && Number.isFinite(queueInfo.hourlyRemaining) ? queueInfo.hourlyRemaining : null
    - overlayMeta.hourlyResetSeconds = queueInfo && Number.isFinite(queueInfo.hourlyResetSeconds) ? queueInfo.hourlyResetSeconds : null
    - overlayMeta.dailyRemaining = queueInfo && Number.isFinite(queueInfo.dailyRemaining) ? queueInfo.dailyRemaining : null
    - overlayMeta.dailyResetSeconds = queueInfo && Number.isFinite(queueInfo.dailyResetSeconds) ? queueInfo.dailyResetSeconds : null
    - overlayMeta.sourceIdent = queueInfo && typeof queueInfo.sourceIdent === 'string' ? queueInfo.sourceIdent : null
    - overlayMeta.message = typeof message === 'string' ? message : null
    .position-relative(style="min-height: 100vh;")
      +reportLoadingOverlay(overlayMeta, { id: 'pageReportOverlay', autoShow: true, reloadUrl: reloadUrl })
      noscript
        .container.pt-5
          .alert.alert-info
            | CRM формує дані. Увімкніть JavaScript для автоматичного оновлення або перейдіть за посиланням:&nbsp;
            if reloadUrl && reloadUrl.length
              a(href=reloadUrl) оновити сторінку
            else
              span повторіть запит пізніше.
