.settings-section
  - const accessConfig = securityConfig || {}
  - const accessEnabled = Boolean(accessConfig.pinEnabled)
  - const accessHasExisting = Boolean(accessConfig.pinSalt && accessConfig.pinHash)
.panel-card
  .panel-header
    h2 Доступ к сервису
    span.status-tag.badge(class=accessEnabled ? 'badge-success' : 'badge-secondary')= accessEnabled ? 'Включено' : 'Выключено'
  .panel-body
      p.text-muted
        | Управление логином и паролем для доступа к отчётам. Текущая сессия действует 1 час.
      form(method="post", action="/auth/pin/settings", data-report-form data-has-existing=accessHasExisting ? 'true' : 'false')
        input(type="hidden", name="returnTo", value="/settings?tab=access")
        .custom-control.custom-switch.mb-3
          input#settingsAccessEnabled.custom-control-input(type="checkbox", name="enablePin", checked=accessEnabled ? true : false)
          label.custom-control-label(for="settingsAccessEnabled") Включить парольную защиту
        .form-row
          .col-md-6.mb-3
            label(for="settingsUsername") Имя пользователя
            input#settingsUsername.form-control(type="text", name="username", value=accessConfig.username || 'gouads', maxlength="32", required, autocomplete="username")
          .col-md-6.mb-3
            label Статус
            p.form-control-plaintext= accessEnabled ? 'Защита активна' : 'Защита отключена'
        .form-row
          .col-md-6.mb-3
            label(for="settingsNewPassword") Новый пароль
            input#settingsNewPassword.form-control(type="password", name="newPin", minlength="4", maxlength="32", autocomplete="new-password", placeholder="Введите новый пароль", disabled=!accessEnabled)
          .col-md-6.mb-3
            label(for="settingsConfirmPassword") Подтвердите пароль
            input#settingsConfirmPassword.form-control(type="password", name="confirmPin", minlength="4", maxlength="32", autocomplete="new-password", placeholder="Повторите пароль", disabled=!accessEnabled)
        small.form-text.text-muted Если оставить поля пустыми, сохранится текущий пароль.
        button.btn.btn-outline-secondary.rounded-pill.mt-4(type="submit")
          i.bi.bi-shield-check.mr-2
          | Сохранить настройки
